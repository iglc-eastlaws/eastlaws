@using System.Text;
@using Eastlaws.Infrastructure;
@model Eastlaws.Entities.AhkamPresentation
@{
    Layout = null;

    var countrow = 0;
}



@if (Model != null)
{

    <input type="hidden" value="@Model.ResultsCount" id="resultCount" />
    <input type="hidden" value="@Model.QueryID" id="queryHandle" />
    <input type="hidden" value="@ViewBag.typeView" id="typeView" />

    @if (!string.IsNullOrWhiteSpace(Model.PresentationTitle))
    {
        <h4 class="text-center">
            <i class="fa fa-balance-scale" aria-hidden="true"></i>
            <span class="">
                @Model.PresentationTitle
            </span>
        </h4>

    }

    if ((ViewBag.typeView == 1))
    {

        <div class="view-law tabel-views widget  widget-table action-table">

            <div class="col-lg-7 col-md-7 widget-content">
                <div class="widget-header">

                    <h3>
                        <i class="fa fa-legal "></i>&nbsp;<span class="main-title">استعراض الأحكام العربية</span>
                    </h3>
                </div>

                <div class="list-table">

                    <table class="table table-striped table-bordered table-fixed table-responsive">
                        <thead>
                            <tr>
                                <th >الدولة</th>
                                <th>المحكمه</th>
                                <th>رقم الطعن</th>
                                <th>السنة</th>
                                <th>تاريخ الجلسة</th>
                                @*<th>مكتب فنى</th>*@
                            </tr>
                        </thead>
                        <tbody>

                            @foreach (var item in Model.AhkamList)
                            {
                                <tr class="hokmView" data-idhokm="@item.ID">
                                    <td>@item.CountryName</td>
                                    <td>@item.MahkamaName</td>
                                    <td>@item.CaseNo</td>
                                    <td>@item.CaseYear</td>
                                    <td style="font-size:0.9em;">@DateTime.Parse(item.CaseDate.ToString()).ToString("dd/M/yyyy")</td>
                                    @*<td>@item.OfficeSuffix</td>*@

                                </tr>

                            }


                        </tbody>
                    </table>

                </div>
            </div>
            <div class="col-lg-5 col-md-5 widget-content">
                <div class="widget-header">

                    <h3>
                        <i class="fa fa-desktop"></i>&nbsp;<span class="main-title"> عرض الحكم </span>
                    </h3>
                </div>
                <div id="hokmview"></div>
            </div>
            <hr class="spacer" />

        </div>





    }
    else if ((ViewBag.typeView == 2) || (ViewBag.typeView == 3))
    {
        @foreach (var item in Model.AhkamList)
        {
            countrow += 1;

            var Fakrat = Model.FakaratList.Where(p => p.HokmID == @item.ID).ToArray();

            <div class="result-block @((ViewBag.typeView == 3)?"col-md-4":"")">

                <h4><i class="fa fa-bank fa-2x icon"></i></h4>
                <div class="row-search selector">


                    <h3><img src="~/Content/images/Flags/Small/@item.CountryFlagPic" width="16" height="11" alt="" />&nbsp; @item.FullName</h3>
                    @for (int i = 0; i < Fakrat.Length; i++)
                    {
                        var CurrentFakra = Fakrat[i];
                        string FakraText = gerFakraText(CurrentFakra.Text,
                                                        CurrentFakra.FakraNo,
                                                        Model.TextPredicates).ToString();

                        <p>
                            <span class="fakr-title-search" style="color:red;">
                                @CurrentFakra.Title :
                            </span>
                            <a class="fakra-text" target="_blank" href="View?ID=@item.ID#@CurrentFakra.ID" >@Html.Raw(FakraText)</a>
                        </p>

                        if (i < Fakrat.Length - 1 && Fakrat.Length > 1)
                        {
                            <div class="fakarat-search-separator">
                                <hr />
                            </div>
                        }
                    }


                    <div class="nav-control">
                        <ul>
                            <li><a href="#"><i class="fa fa-desktop"></i> قراءة النص</a></li>
                            <li><a href="#"><i class="fa fa-camera"></i> صورة الحكم</a></li>
                            <li><a href="#"><i class="fa fa-print"></i> طباعة </a></li>
                        </ul>
                    </div>
                    <hr class="spacer" />
                </div>
            </div>
            @if (countrow % 3 == 0)
            {
                <hr class="spacer" />
            }
        }
        @if (countrow == 0)
        {
            <h3>لا يوجد نتائج</h3>
        }
    }
    else if (Model == null)
    {
        <h3>لا يوجد نتائج</h3>
    }
}






@functions{
    public static StringBuilder gerFakraText(string FakraText, int FakraNo, List<FTSPredicate> PredicatesHighlight)
    {
        var Result = new StringBuilder();
        int MaxFakraTextLen = 250;

        if (PredicatesHighlight == null || PredicatesHighlight.Count == 0)
        {
            FakraText = FakraText.Substring(0, Math.Min(FakraText.Length, MaxFakraTextLen));

        }
        else
        {
            var MatchingPredicate = (from x in PredicatesHighlight
                                     where Convert.ToInt32(x.Tag) == FakraNo || Convert.ToInt32(x.Tag) == 5000
                                     orderby Convert.ToInt32(x.Tag)
                                     select x).FirstOrDefault();

            if (MatchingPredicate == null)
            {
                FakraText = FakraText.Substring(0, Math.Min(FakraText.Length, MaxFakraTextLen));
            }
            else
            {
                FakraText = Temp.HighlightTextTrim(FakraText, MatchingPredicate.Input, MatchingPredicate.SqlMode, MaxFakraTextLen);
            }
        }
        Result.Append(FakraText);
        return Result;
    }

}